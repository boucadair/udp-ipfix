



OPSAWG                                                      M. Boucadair
Internet-Draft                                                    Orange
Intended status: Standards Track                              T. Reddy.K
Expires: 16 November 2024                                          Nokia
                                                             15 May 2024


Export of UDP Options Information in IP Flow Information Export (IPFIX)
                draft-ietf-opsawg-tsvwg-udp-ipfix-latest

Abstract

   This document specifies new IP Flow Information Export (IPFIX)
   Information Elements for UDP options.

Discussion Venues

   This note is to be removed before publishing as an RFC.

   Discussion of this document takes place on the Operations and
   Management Area Working Group Working Group mailing list
   (opsawg@ietf.org), which is archived at
   https://mailarchive.ietf.org/arch/browse/opsawg/.

   Source for this draft and an issue tracker can be found at
   https://github.com/boucadair/udp-ipfix.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 16 November 2024.

Copyright Notice

   Copyright (c) 2024 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Revised BSD License text as
   described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Revised BSD License.

Table of Contents

   1.  Introduction
   2.  Conventions and Definitions
   3.  UDP Options at a Glance
   4.  New UDP IPFIX Information Elements
     4.1.  udpSafeOptions
     4.2.  udpUnsafeOptions
     4.3.  udpExID
     4.4.  udpSafeExIDList
     4.5.  udpUnsafeExIDList
   5.  Examples
     5.1.  Reduced-size Encoding
     5.2.  SAFE Experimental Option
     5.3.  ExIDs and Reduced-size Encoding
   6.  Security Considerations
   7.  IANA Considerations
     7.1.  IPFIX Information Elements
     7.2.  IPFIX Information Element Data Type
       7.2.1.  unsigned192 Data Type
   8.  References
     8.1.  Normative References
     8.2.  Informative References
   Acknowledgments
   Authors' Addresses

1.  Introduction

   IP Flow Information Export (IPFIX) [RFC7011] is a protocol that is
   widely deployed in operators networks for traffic management purposes
   (Section 2 of [RFC6632]).  The protocol specifies the encoding of a
   set of basic data types and how the various Information Elements
   (IEs) are transmitted.  In order to support the export of new flow-
   related measurement data, new IEs can be defined and registered in a
   dedicated IANA registry [IANA-IPFIX] for interoperability.

   This document specifies new IPFIX Information Elements for UDP
   options (Section 4).  A brief overview of UDP options is provided in
   Section 3.

   The IE specified in Section 4.1 uses the new abstract data type
   defined in Section 7.2.

   Transport (including MTU) considerations are discussed in Section 10
   of [RFC7011].

   Examples to illustrate the use of the new IPFIX Information Elements
   are provided in Section 5.

2.  Conventions and Definitions

   This document uses the IPFIX-specific terminology (e.g., Flow)
   defined in Section 2 of [RFC7011].  As in [RFC7011], these IPFIX-
   specific terms have the first letter of a word capitalized.

   The document adheres to the naming conventions for Information
   Elements per Section 2.3 of [RFC7012].

   Also, this document uses the terms defined in Section 3 of
   [I-D.ietf-tsvwg-udp-options], especially "datagram" and "surplus
   area".

3.  UDP Options at a Glance

   UDP [RFC0768] does not support an extension mechanism similar to the
   options supported by other transport protocols, such as TCP
   [RFC9293], SCTP [RFC9260], or DCCP [RFC4340].  Such a mechanism can
   be useful for various applications, e.g., to discover a path MTU or
   share timestamps.  To fill that void, [I-D.ietf-tsvwg-udp-options]
   extends UDP with a mechanism to insert extensions in datagrams.  To
   do so, and unlike the conventional approach that relies upon
   transport headers, [I-D.ietf-tsvwg-udp-options] uses trailers.
   Concretely, UDP options are placed in the surplus area (that is, the
   area of an IP payload that follows a UDP packet).  See Figure 1.  An
   example of the use of UDP options is described in
   [I-D.ietf-tsvwg-udp-options-dplpmtud].

                             IP transport payload
                <------------------------------------------------->
      +--------+---------+----------------------+------------------+
      | IP Hdr | UDP Hdr |     UDP user data    |   surplus area   |
      +--------+---------+----------------------+------------------+
                <------------------------------>
                           UDP Length

                           Figure 1: Surplus Area

   Sections 4.1 and 4.2 introduce new IEs to export the observed UDP
   options.

   Options indicated by Kind values in the range 0-191 are called SAFE
   options.  Such options can be silently ignored by legacy receivers
   because they do not alter the UDP user data (Section 11 of
   [I-D.ietf-tsvwg-udp-options]).  Safe options are exported using the
   IE defined in Section 4.1.

   Options indicated by Kind values in the range 192-255 are called
   UNSAFE options.  Such options are not safe for legacy receivers to
   ignore because they alter the UDP user data (Section 12 of
   [I-D.ietf-tsvwg-udp-options]).  Unsafe options are exported using the
   IE defined in Section 4.2.

   UDP options occur per-packet within a Flow and can be inserted at any
   time in the Flow.

   [I-D.ietf-tsvwg-udp-options] reserves two options for experiments:
   the Experimental option (EXP, Kind=127) for SAFE options and the
   UNSAFE Experimental option (UEXP, Kind=254).  For both options,
   Experiment Identifiers (ExIDs) are used to differentiate concurrent
   use of these options.  Known ExIDs are expected to be registered
   within IANA.  Section 4.4 specifies a new IPFIX IE to export observed
   ExIDs in the EXP options.  Also, Section 4.5 specifies a new IPFIX IE
   to export observed ExIDs in the UEXP options.  Only 16-bit ExIDs are
   supported in [I-D.ietf-tsvwg-udp-options].

   This document does not intend to elaborate operational guidance/
   implications of UDP options.  The document focuses exclusively on
   exporting observed UDP options in datagrams.

4.  New UDP IPFIX Information Elements

      RFC Editor Note: Please update "URL_IANA_UDP_OPTIONS" reference
      with the URL of the "UDP Option Kind Numbers" registry group and
      "URL_IANA_UDP_ExIDs" with the URL of the "UDP Experimental Option
      Experiment Identifiers (UDP ExIDs)" registry that will be created
      by IANA as per Section 25 of [I-D.ietf-tsvwg-udp-options].

   Given the Kind structure of safe and unsafe UDP options, distinct IEs
   are defined to report safe (Section 4.1) and unsafe (Section 4.2) UDP
   options rather using one single IE that would multiplex both types of
   option.  The design in the document is compatible with the use of the
   reduced-size encoding (Section 6.2 of [RFC7011]).

4.1.  udpSafeOptions

   Name:  udpSafeOptions

   ElementID:  TBD1

   Description:  Observed safe UDP options in a Flow.  The information
      is encoded in a set of bit fields.

      Options are mapped to bits according to their option numbers.  UDP
      option Kind 0 corresponds to the least-significant bit in the
      udpSafeOptions IE while Kind 191 corresponds to the most-
      significant bit of the IE.  The bit is set to 1 if the
      corresponding safe UDP option is observed in the Flow.  The bit is
      set to 0 if the option is not observed in the Flow.

      The reduced-size encoding specified in Section 6.2 of [RFC7011] is
      followed whenever fewer octets are needed to report observed safe
      UDP options.  For example, if only option Kinds <= 32 are
      observed, then the value of the udpSafeOptions IE can be encoded
      as unsigned32, or if only option Kinds <= 63 are observed, then
      the value of the udpSafeOptions IE can be encoded as unsigned64.

      The presence of udpSafeExIDList is an indication that the SAFE
      Experimental option is observed in a Flow.  The presence of
      udpSafeExIDList takes precedence over setting the correspoding bit
      in the udpSafeOptions IE for the same Flow.  In order to make use
      of the reduced-size encoding in the presence of udpSafeExIDList
      IE, the Exporter MUST NOT set to 1 the EXP flag of the
      udpSafeOptions IE that is reported for the same Flow.

   Abstract Data Type:  unsigned192

   Data Type Semantics:  flags

   Additional Information:  See the "UDP Option Kind Numbers" registry
      at [URL_IANA_UDP_OPTIONS].

      See [I-D.ietf-tsvwg-udp-options] for more details about UDP
      options.

   Reference:  This-Document

4.2.  udpUnsafeOptions

   Name:  udpUnsafeOptions

   ElementID:  TBD2

   Description:  Observed unsafe UDP options in a Flow.  The information
      is encoded in a set of bit fields.

      Options are mapped to bits according to their option numbers.  UDP
      option Kind 192 corresponds to the least-significant bit in the
      udpUnsafeOptions IE while Kind 255 corresponds to the most-
      significant bit of the IE.  The bit is set to 1 if the
      corresponding unsafe UDP option is observed in the Flow.  The bit
      is set to 0 if the option is not observed in the Flow.

      The reduced-size encoding specified in Section 6.2 of [RFC7011] is
      followed whenever fewer octets are needed to report observed
      unsafe UDP options.

      The presence of udpUnsafeExIDList is an indication that the UNSAFE
      Experimental option is observed in a Flow.  The presence of
      udpUnsafeExIDList takes precedence over setting the correspoding
      bit in the udpUnsafeOptions IE for the same Flow.  In order to
      make use of the reduced-size encoding in the presence of
      udpUnsafeExIDList IE, the Exporter MUST NOT set to 1 the UEXP flag
      of the udpUnsafeOptions IE that is reported for the same Flow.

   Abstract Data Type:  unsigned64

   Data Type Semantics:  flags

   Additional Information:  See the "UDP Option Kind Numbers" registry
      at [URL_IANA_UDP_OPTIONS].

      See [I-D.ietf-tsvwg-udp-options] for more details about UDP
      options.

   Reference:  This-Document

4.3.  udpExID

   Name:  udpExID

   ElementID:  TBD3

   Description:  Observed ExID in an Experimental option (EXP, Kind=127)
      or an UNSAFE Experimental option (UEXP, Kind=254).

   Abstract Data Type:  unsigned16

   Data Type Semantics:  identifier

   Additional Information:  See the "UDP Experimental Option Experiment
      Identifiers (UDP ExIDs)" registry at [URL_IANA_UDP_ExIDs].

      See [I-D.ietf-tsvwg-udp-options] for more details about ExIDs.

   Reference:  This-Document

4.4.  udpSafeExIDList

   Name:  udpSafeExIDList

   ElementID:  TBD4

   Description:  Observed ExIDs in the Experimental option (EXP,
      Kind=127).

      A basicList of udpExID Information Elements, with each udpExID
      Information Element carries the ExID observed in an EXP option.

   Abstract Data Type:  basicList

   Data Type Semantics:  list

   Additional Information:  See the "UDP Experimental Option Experiment
      Identifiers (UDP ExIDs)" registry at [URL_IANA_UDP_ExIDs].

      See [I-D.ietf-tsvwg-udp-options] for more details about ExIDs.

   Reference:  This-Document

4.5.  udpUnsafeExIDList

   Name:  udpUnsafeExIDList

   ElementID:  TBD5

   Description:  Observed ExIDs in the UNSAFE Experimental option (UEXP,
      Kind=254).

      A basicList of udpExID Information Elements, with each udpExID
      Information Element carries the ExID observed in an UEXP option.

   Abstract Data Type:  basicList

   Data Type Semantics:  list

   Additional Information:  See the "UDP Experimental Option Experiment
      Identifiers (UDP ExIDs)" registry at [URL_IANA_UDP_ExIDs].

      See [I-D.ietf-tsvwg-udp-options] for more details about ExIDs.

   Reference:  This-Document

5.  Examples

5.1.  Reduced-size Encoding

   Given UDP Kind allocation in Section 10 of
   [I-D.ietf-tsvwg-udp-options] and the option mapping defined in
   Section 4.1 of this document, fewer octets are likely to be used for
   Flows with mandatory UDP options.

   Figure 2 shows an example of reported values in a udpSafeOptions IE
   for a Flow in which End of Options List (EOL, Kind=0) and Alternate
   payload checksum (APC, Kind=2) options are observed.  One octet is
   sufficient to report these observed options because the leading zeros
   are dropped per the reduced-size encoding guidance.  Concretely, the
   reported udpSafeOptions IE will be set to 0x05.

       MSB                                                       LSB
                            1                                  19
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 ... 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+-+-+-+-+-+-+-+
       |0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|   |0|0|0|0|0|1|0|1|
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-++-++-+-+-+-+...+-+-+-+-+-+-+-+-+

      Figure 2: An Example of udpSafeOptions with EOL and APC Options

5.2.  SAFE Experimental Option

   Let us now consider a UDP Flow in which SAFE Experimental options are
   observed.  If a udpSafeOptions IE is exported for this Flow, then
   that IE will have the EXP bit set to 1 (Figure 3).  This example does
   not make any assumption about the presence of other UDP options.

        MSB                                                     LSB
                          12                                  19
         0 1 2 3 ... 7 8 9 0 1 2 3 4 5 6 7 8 9 ... 4 5 6 7 8 9 0 1
        +-+-+-+-+...+-+-+-+-+-+-+-+-+-+-+-+-+-+-+...+-+-+-+-+-+-+-+
        |X|X|X|X|   |X|X|X|X|X|X|X|X|X|X|X|1|X|X|   |X|X|X|X|X|X|X|
        +-+-+-+-+...+-+-+-+-+-+-+-+-++-++-+-+-+-+...+-+-+-+-+-+-+-+

           Figure 3: An Example of udpSafeOptions with EXP Option

5.3.  ExIDs and Reduced-size Encoding

   Now assume that EOL, APC, EXP, and UEXP options are observed in a
   Flow.  Let us also consider that the observed SAFE Experimental
   options have ExIDs set to 0x9858 and 0xE2D4, and UNSAFE Experimental
   options have ExIDs set to 0xC3D9 and 0x1234.  Figure 4 shows an
   excerpt of the Data Set encoding with a focus on SAFE Experimental
   options have ExIDs.  The meaning of the fields is defined in
   [RFC6313].

      MSB                                                          LSB
      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     :                           ...                                 :
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |      255      |        List Length = 9        |semantic=allof |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |           udpExID = TBD3      |         Field Length = 2      |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | SAFE ExID =  0x9858           | SAFE ExID = 0xE2D4            |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |      255      |        List Length = 9        |semantic=allof |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |           udpExID = TBD3      |         Field Length = 2      |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | UNSAFE ExID =  0xC3D9         | UNSAFE ExID =  0x1234         |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     :                           ...                                 :

           Figure 4: Example of UDP Experimental Option ExID IEs

   Following the guidance in Section 4.1, the reported udpSafeOptions IE
   will be set to 0x05 even in the presence of EXP options.

6.  Security Considerations

   This document does not introduce new security considerations other
   than those already discussed in Section 11 of [RFC7011] and Section 8
   of [RFC7012].

   The reader may refer to Section 24 of [I-D.ietf-tsvwg-udp-options]
   for the security considerations related to UDP options.

7.  IANA Considerations

7.1.  IPFIX Information Elements

   This document requests IANA to add the following new IEs to the
   "IPFIX Information Elements" registry under the "IP Flow Information
   Export (IPFIX) Entities" registry group [IANA-IPFIX]:

       +=======+===================+==============================+
       | Value | Name              | Reference                    |
       +=======+===================+==============================+
       | TBD1  | udpSafeOptions    | Section 4.1 of This-Document |
       +-------+-------------------+------------------------------+
       | TBD2  | udpUnsafeOptions  | Section 4.2 of This-Document |
       +-------+-------------------+------------------------------+
       | TBD3  | udpExID           | Section 4.3 of This-Document |
       +-------+-------------------+------------------------------+
       | TBD4  | udpSafeExIDList   | Section 4.4 of This-Document |
       +-------+-------------------+------------------------------+
       | TBD5  | udpUnsafeExIDList | Section 4.5 of This-Document |
       +-------+-------------------+------------------------------+

                 Table 1: New IPFIX Information Elements

      udpSafeOptions uses the abstract data type ("unsigned192") defined
      in Section 7.2.

7.2.  IPFIX Information Element Data Type

   This document requests IANA to add the following new abstract data
   type to the "IPFIX Information Element Data Types" registry under the
   "IP Flow Information Export (IPFIX) Entities" registry group
   [IANA-IPFIX]:

                  +=======+=============+===============+
                  | Value | Description | Reference     |
                  +=======+=============+===============+
                  | TBD6  | unsigned192 | This-Document |
                  +-------+-------------+---------------+

                       Table 2: New IPFIX Information
                             Element Data Type

7.2.1.  unsigned192 Data Type

   The type "unsigned192" represents a non-negative integer value in the
   range of '0' to '2^192 - 1'.  Similar to Section 6.1.1 of [RFC7011],
   this type MUST be encoded using the default canonical format in
   network byte order.

   Reduced-Size encoding (Section 6.2 of [RFC7011]) applies to this data
   type.  The reduction in size can be to any number of octets smaller
   than the unsigned192 type if the data value still fits, i.e., so that
   only leading zeroes are dropped.

8.  References

8.1.  Normative References

   [I-D.ietf-tsvwg-udp-options]
              Touch, J. D., "Transport Options for UDP", Work in
              Progress, Internet-Draft, draft-ietf-tsvwg-udp-options-32,
              21 March 2024, <https://datatracker.ietf.org/doc/html/
              draft-ietf-tsvwg-udp-options-32>.

   [RFC0768]  Postel, J., "User Datagram Protocol", STD 6, RFC 768,
              DOI 10.17487/RFC0768, August 1980,
              <https://www.rfc-editor.org/rfc/rfc768>.

   [RFC6313]  Claise, B., Dhandapani, G., Aitken, P., and S. Yates,
              "Export of Structured Data in IP Flow Information Export
              (IPFIX)", RFC 6313, DOI 10.17487/RFC6313, July 2011,
              <https://www.rfc-editor.org/rfc/rfc6313>.

   [RFC7011]  Claise, B., Ed., Trammell, B., Ed., and P. Aitken,
              "Specification of the IP Flow Information Export (IPFIX)
              Protocol for the Exchange of Flow Information", STD 77,
              RFC 7011, DOI 10.17487/RFC7011, September 2013,
              <https://www.rfc-editor.org/rfc/rfc7011>.

   [RFC7012]  Claise, B., Ed. and B. Trammell, Ed., "Information Model
              for IP Flow Information Export (IPFIX)", RFC 7012,
              DOI 10.17487/RFC7012, September 2013,
              <https://www.rfc-editor.org/rfc/rfc7012>.

8.2.  Informative References

   [I-D.ietf-tsvwg-udp-options-dplpmtud]
              Fairhurst, G. and T. Jones, "Datagram PLPMTUD for UDP
              Options", Work in Progress, Internet-Draft, draft-ietf-
              tsvwg-udp-options-dplpmtud-12, 7 May 2024,
              <https://datatracker.ietf.org/doc/html/draft-ietf-tsvwg-
              udp-options-dplpmtud-12>.

   [IANA-IPFIX]
              "IP Flow Information Export (IPFIX) Entities", n.d.,
              <https://www.iana.org/assignments/ipfix/ipfix.xhtml>.

   [RFC4340]  Kohler, E., Handley, M., and S. Floyd, "Datagram
              Congestion Control Protocol (DCCP)", RFC 4340,
              DOI 10.17487/RFC4340, March 2006,
              <https://www.rfc-editor.org/rfc/rfc4340>.

   [RFC6632]  Ersue, M., Ed. and B. Claise, "An Overview of the IETF
              Network Management Standards", RFC 6632,
              DOI 10.17487/RFC6632, June 2012,
              <https://www.rfc-editor.org/rfc/rfc6632>.

   [RFC9260]  Stewart, R., Tüxen, M., and K. Nielsen, "Stream Control
              Transmission Protocol", RFC 9260, DOI 10.17487/RFC9260,
              June 2022, <https://www.rfc-editor.org/rfc/rfc9260>.

   [RFC9293]  Eddy, W., Ed., "Transmission Control Protocol (TCP)",
              STD 7, RFC 9293, DOI 10.17487/RFC9293, August 2022,
              <https://www.rfc-editor.org/rfc/rfc9293>.

   [URL_IANA_UDP_ExIDs]
              "UDP Experimental Option Experiment Identifiers (UDP
              ExIDs)", n.d., <https://www.iana.org/assignments/url2>.

   [URL_IANA_UDP_OPTIONS]
              "UDP Option Kind Numbers", n.d.,
              <https://www.iana.org/assignments/url1>.

Acknowledgments

   Thanks to Benoît Claise for the discussion on the ordering of IPFIX
   IEs.  Thanks to Paul Aitken for the review and comments.

   Thanks to Tommy Pauly for the tsvart review, Joe Touch for the intdir
   review, Robert Sparks for the genart review, and Watson Ladd for the
   secdir review.

   Thanks to Thomas Graf for the Shepherd review.

   Thanks to Mahesh Jethanandani for the AD review.

Authors' Addresses

   Mohamed Boucadair
   Orange
   35000 Rennes
   France
   Email: mohamed.boucadair@orange.com


   Tirumaleswar Reddy.K
   Nokia
   India
   Email: kondtir@gmail.com
